var myQuestions = [
	{
		question: "1.	「死刑過於殘酷，違反人權」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
	{
		question: "2.	「有冤獄的可能性，冤獄、誤判是無法挽回的」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "3.	「人有教化之可能性，應發揮在教育精神」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "4.	「死刑無法嚇阻犯罪」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
        question: "5.	「死刑不符合比例原則，終身監禁可取代」您是否支持此論點呢?意指: 終身監禁也能達到跟死刑類似的效果，此時就不該用殺人性命這種最嚴酷的手段。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "6.	「殺人償命，一命抵一命」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "7. 「執行死刑才可彰顯社會正義，還給受害家屬一個公道」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "8.	「死刑具有嚇阻作用，維護社會秩序」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "9.	「不應該浪費納稅人的錢來養犯人一輩子」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "10.	「重大犯罪者再犯率高，並非每個人都能教化成功」您是否支持此論點呢?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "11.	請問您個人的立場是 支持【死刑】 或者是 支持【廢除死刑】?",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "12.	政府應立法保障動物的權利",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "13.	如果動物患上不治之症，人類有權將牠人道毀滅(安樂死)。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "14.	為控制流動物數目，應將部分的流浪動物人道毀滅(安樂死)。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "15.	人道毀滅(安樂死)能減輕動物痛苦。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "16.	政府應成立動物警察捉拿虐待動物人士。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "17.	加重虐待動物的刑罰有助減低虐待動物罪案。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "18.	以現在台灣現有的情形，你認為保障動物權益的組織能否發揮其保護所有動物的功效。",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "19. 我總是聚會上炒熱氣氛的人",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "20. 我對人感興趣",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "21. 我喜歡躲在人群的背後，不喜歡引人注目",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "22. 我不太健談",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "23. 我不喜歡被別人注意",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "24. 我常抽空幫助別人",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "25. 我不愛和陌生人說話",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    },
    {
		question: "26. 我讓別人在和我相處時感覺很放鬆",
		options: [
            {5: '非常同意'},
            {4: '同意'},
            {3: '沒意見'},
            {2: '不同意'},
            {1: '非常不同意'}
        ],
    }     
];

$(document).ready( function() {
    showQuestions(myQuestions, document.getElementById('question-container'));
});

function showQuestions(questions, quizContainer){
    var output = [];
    var options;

    // for each question
    for(var i=0; i<questions.length; i++){
        
        options = [];
        // for each available option to this question...
        for(var j=0; j<questions[i].options.length; j++){
            var score = Object.keys(questions[i].options[j])[0];

            options.push(
                '<div class="form-check">'
                    + '<input class="form-check-input" type="radio" name="question'+i+'" value='+ score + '>'
                    + '<label class="form-check-label">'
                    + questions[i].options[j][score]
                + '</label></div>'
            );
        }

        // add this question and its options to the output
        output.push(
            '<div class="card mb-3"><div class="card-body form-group.required"><p class="card-text">' + questions[i].question + '</p>'
            + '<div class="options">' + options.join('') + '</div></div></div>'
        );
    }
    // finally combine our output list into one string of html and put it on the page
    quizContainer.innerHTML = output.join('');
}

function sendResult(ans, score){
    var data = {"score": score};
    let id = $('#id-input').text();
    var url = "https://script.google.com/macros/s/AKfycbyABZt9bsN8ghP5LCLGeyQwJ1zp5YGbCPxjpLYFVQMU-ExnSVP7/exec";
    $.ajax({
        async: true,
        crossDomain: true,
        url: url,
        data: {
            "id": id,
            "answers": ans.toString()
            // 自動偵測填答完畢
        },
        'Access-Control-Allow-Origin': '*',
        success: function(response) {
            $.ajax({
                async: true,
                crossDomain: true,
                url: "/sendResult",
                type: 'post',
                data: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                },
                dataType: 'json',
                // 結果成功回傳
                success: function (result) {
                    console.log(result);
                    location.href = "/";
                }
            });
      },
    });
}

function showResults(){
    var questions = myQuestions;
	var quizContainer = document.getElementById('question-container');
    var answerContainers = quizContainer.querySelectorAll('.options');
    var ans = [];
    var sum = 0;

    // 最後八題不列入計算
    var excludeQuestion = 8;
	// 檢查每個問題選項
	for(var i=0; i<questions.length; i++){
        // 檢查是否每個問題都有回答
        if(answerContainers[i].querySelector('input[name=question'+i+']:checked') == null){
            alert("請作答所有問題");
            return;
        }
        ans.push(answerContainers[i].querySelector('input[name=question'+i+']:checked').value);
        // 加總選項分數
        if (i<questions.length-excludeQuestion)
		    sum += parseInt((answerContainers[i].querySelector('input[name=question'+i+']:checked') || 0).value);
    }
    
    // TODO: 儲存到資料庫或csv
    sendResult(ans, sum);
}